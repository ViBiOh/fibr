apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: fibr
  namespace: default
spec:
  interval: 120m
  chart:
    spec:
      chart: app
      version: "0.0.92"
      sourceRef:
        kind: HelmRepository
        name: vibioh
      interval: 120m
  install:
    crds: Skip
  maxHistory: 3
  upgrade:
    remediation:
      retries: 3
  rollback:
    cleanupOnFail: true
  values:
    nameOverride: fibr
    image:
      name: vibioh/fibr
      tag: "202312262224" # {"$imagepolicy": "default:flux-fibr-web:tag"}
    volumes:
      - name: data
        persistentVolumeClaim:
          claimName: fibr
      - name: tmp
        emptyDir: {}
    volumeMounts:
      - name: data
        mountPath: /data
      - name: tmp
        mountPath: /tmp
    config:
      FIBR_CHUNK_UPLOAD: "true"
      FIBR_EXIF_DIRECT_ACCESS: "true"
      FIBR_EXIF_URL: http://exas
      FIBR_IGNORE_PATTERN: ".st(folder|ignore)"
      FIBR_LOGGER_JSON: "true"
      FIBR_PUBLIC_URL: https://fibr.vibioh.fr
      FIBR_REDIS_ADDRESS: redis:6379
      FIBR_REDIS_DATABASE: "6"
      FIBR_REDIS_MIN_IDLE_CONN: "50"
      FIBR_REDIS_POOL_SIZE: "500"
      FIBR_SANITIZE_ON_START: "true"
      FIBR_TELEMETRY_URL: datadog.observability:4317
      FIBR_THUMBNAIL_DIRECT_ACCESS: "true"
      FIBR_THUMBNAIL_LARGE_SIZE: "1000"
      FIBR_THUMBNAIL_MIN_BITRATE: "30000000"
      FIBR_THUMBNAIL_URL: http://vith
      GOMAXPROCS: "1"
      OTEL_RESOURCE_ATTRIBUTES: env=production,git.repository_url=github.com/ViBiOh/fibr
      OTEL_SERVICE_NAME: fibr
    secrets:
      FIBR_AMQP_URI: AgA9cvt+WxhWbE0BhP+LdNOgUWVNaLr8BBpi1BSVmHByUsUkRwM2rrN6wncgPTfJGW2nRzah+tYfgs2A31d3eNpi1UuG4ndH6IRSxrUJqA5FUXha8NlN5jzpqALFcIaEP0zavkef5U9YmuO3UdUT9o/thHwwJzy+au0DI44qtImIsEtOsVzq4fwBGIt2A+z5QqmeZK0TMcao630QqwLoksY0C0ZR+XomxuaGUCdR7xgiuQnHKeSp9idXoQc5sa84EEuoix+FCXuMwKn26dSytqLgeYpND2Ryj0WeRX6zl4Mf5V65PDBMqPxNvn9l+QxoKbM4HB++6N8oAvfkHQTCIqKH8lsrznpguYt1dYDEZwkMK6ho1Xy/ZVPGdKAELKdt+SYWoaZ9DV4A/sj4SkRFuGvPkoAc8raS/bxyWGbLWtwvCYSr0P99M7zTSDiNzEqy+3zjS0Q6vYE+JPKvAHwMrpAjWzB2hT0en10LPPnjNDNcSRPo118mzpopik752t6Ejx3JzAVU2OI08eSxxoejh/ZabuPocaZIseBRvWxHYoXVbLMgbmuEmvYc0PXm+/FNUsj/d7gs7aEsl5OUDwgpjDUtaq90eW5aUZb6OrGp2sKc3OmXDGq4IWDdqbBV7mzt/sjTvULBe9LwunneZN9OUJvYj5+r5107qaxzOQYmwYx8Qvs7GECbxcXofKg1lfWKUzbnFn9ekbqPegOSTQ5XD/y3LHimvaKtnpKHRXkAW5Si9krBExtljW8WHpTsW2nP9Rhf
      FIBR_AUTH_USERS: AgAsKCdUL2LhMJwpK2C9v6IYmYZvhabTQJs797WyCt9TwJR8B2qZzlnDjaLPZLd24vO/i2Y0ACCpN4CEOmWnI4wY03BZcA4RkwYWQMzAllFLiHsJZKlDiIiC/tGTWOZQK3vjxYBTeJv3cDk8l2Quc+rYo/j7frilYblpWe8h8saNUXmxC4wIWJ4PYjeHnMKufSZa29g0jCvSnGW0pHO08rjsAIu6p6eBbL+Qx+M1LUU7x+HZ8U5Irz9sFMJHEfaLM51JZwLyUk6Xwl57d0G/F9UP2BnPQ2QlhlBMeCItxfTW5NVe5teyZH5aF9J8gZTXV0FmjF49MYDhQZKpBv9W69TIxX1+75hfOHYn00w08+bnIRluH8MnbAFDQ9afSPybQP5FxwjOtD5u4mY2u6uVavuxpk5NO6bTi1QHXsLrFXMh2WJZAdRphSKURc5igevG0f03/2FZalaKzlgK6WrNwVnQnT/p8ln+tasbJKK3pfQmc6KG0VfHVdFSD1X8ojGPRgnPEz+VYZTayEEMF1d1selmSjOudcfpyxfuhh3qyuq3tUyxN3E1fqYj/U3cwCx5OuAI3SKOl3yoxPM3ATpzHj/z9pHM/2Z5Dg4ne5aZ5NpnOAzeabiDg/YOQtMm7fqYdQV3eGl5LS7ScLyQR40UU60AZ0ti7VoVd8ZGXE9rb0F0hVVJRcIT5Fe83bP393KdUkTCs9jtMmt5UiBU9rDE2Fmm1ZLLq/k7gx8doCAKoml7BgqQd+0GtW0Vc4oCPNdQrBfDhj3zjs5GF4fksIZTvqWz8vOS+w8=
      FIBR_REDIS_PASSWORD: AgCnyufAnddFZgVpshL9KFWbkXvtidyO2AlhFpcv3nPiGlqb+QqxC5M2ZaLEzt1vZuaLb3hkDSl1zBy7usmLhPCqsTGCH0JH2tGPkxo8OKa9eFTXzT0EKtoJI7HKHK7D1b5z9IhSEa+sPXvYWVtLjCSvfAXw8/pI+MoDlu1TGmHZvqDpthK1OTu048gVY9NBylpudZ2kQA33Ccfx8tQ0w7RJEswOMScMJ+w7iVuDZrc84NZ0NwdI+lxiTBIP3g2iCh1ENf/2pcB6DqWg5oeFqoYZvK9UXA4qVs/1/EYss7FoODwTnDletITjrfQkx2N9/Z4xUFnW3tY8EITYX5t8uflYg690vfYFBmIoPBpGMHdEr/aicj0YqqtH/7YG4q7ubJqmiGNAjVtUhe9p1jRNppRQQbuLvwKCwxOGMGl9ecUKci9MdR+qM049SSVZJHY1QdZreOoVb4hnrbxQq0s8qyF47IpkwaBh+KEJSepQ7AG2h0wzGc2ln5k7CE5fob0txUzk+Y2nns81maH1nWixCioRDwVMfBjcDWPB3Q5hDt6kHqIpunSEqoe0GVP6SH8ncmcbkJTPwqL44XwTiKcVrTBNuxDbbflTZ0FgXmJP41L6WiScwxN3i6SFTHa3T3rWrktqOHULXabb2UTsW+VvtdX+wx7o35mqaLdI2dkFuB8ZdtWDejX+AZ62hmoK+8tZNsIYWXplaIKYDMojeGJl/JmKsXPbc5QPYYW+8txFImmtyAvXTzY8rF5DSiosZoGeQ97bVZdAHv1rQlrBHAWz+Pg=
      FIBR_WEBHOOK_SECRET: AgABOeEa3Obbd73SJR32wQ3g5xIlBPCT1jQ3DKYOjzjr6tjz/TmOaVepNtBcX8EU++SQw5tGM6KRJPRyf3bUYKCGnmEsbujJ4OY1MdhaY2iB2FslxMQnx97hvbvYglPltp3hsBuO35r1tzCxXJgWKdWpOSEYQRrGcwzDOGQY71rJX2bMv+lQ4Jr4zXQfsfCW2tCFcpyp5nm6gXmmR0ewlQosdhVEJNXCq1njB42bTVvwLwFKsFIBzLONQYNWLqEa5FVz7EiUkU8ro3ax5So62a8R08bmDAdIzm1TZjdjGywQ23NbGgX6cP8GwAqaenOZ0SE74UXui/ff5HGVef3mGTNYpWlEONfB6qsjemOzR9SihXMysGJMrQ3AnL3VUZJnBUKttxd/iz7hTVHqPcv8rrKESOrODtl94QCIy+7K/u3kZgwlIYj6nn29jo8I/Wpr0Q/1HfUHLIjkPendwr9CTKrmrwKRAl1SkBsoIKGh7WZ8/UFXyQp+fuKdVEzIQ/K4ed/zpJ73MVzX8ATrHa3teBhg69bG/sPgyK7LhE8VbQ57f1gUaZ6VPsBQGRkG/7qsfDSD8MjQhJrAzoIS/THqwN9zWsyzc+Gv/uWMr++kwm2CLeD7yw1SZCpvBB4ebM6GEXH7qtuJQ7W07t/1Rwezhv1JqLKPdl0MAXKJ7VTdZANnvz5ge9KinlMsSli4a8dr1KOtsTW52+C2CiTDkQ2G/RmaQi4VBSpxrioKvVwRkRaWTxy/RO7PPazOy1LvjdjycW4MasPP2PmCyouODR0nUctyADdELxTmUgHIvdUUQ+tDsKkZKo0akn/gTrSBSCFV
    resources:
      limits:
        memory: 256Mi
      requests:
        memory: 128Mi
    securityContext:
      runAsGroup: 1000
      runAsUser: 1000
      runAsNonRoot: true
      allowPrivilegeEscalation: false
    autoscaling:
      enabled: false
    ingress:
      enabled: false
      sticky: true
      compress: false
      hosts:
        - fibr.vibioh.fr
    pprof:
      enabled: true
