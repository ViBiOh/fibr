apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: fibr
  namespace: default
spec:
  interval: 120m
  chart:
    spec:
      chart: app
      version: '0.0.81'
      sourceRef:
        kind: HelmRepository
        name: vibioh
      interval: 120m
  install:
    crds: Skip
  maxHistory: 3
  upgrade:
    remediation:
      retries: 3
  rollback:
    cleanupOnFail: true
  values:
    nameOverride: fibr
    image:
      name: vibioh/fibr
      tag: '202206251610' # {"$imagepolicy": "default:flux-fibr-web:tag"}
    volumes:
      - name: data
        persistentVolumeClaim:
          claimName: fibr
    volumeMounts:
      - name: data
        mountPath: /data
    config:
      FIBR_EXIF_DIRECT_ACCESS: 'true'
      FIBR_EXIF_URL: http://exas
      FIBR_IGNORE_PATTERN: '.st(folder|ignore)'
      FIBR_LOGGER_JSON: 'true'
      FIBR_PUBLIC_URL: https://fibr.vibioh.fr
      FIBR_SANITIZE_ON_START: 'true'
      FIBR_THUMBNAIL_DIRECT_ACCESS: 'true'
      FIBR_THUMBNAIL_LARGE_SIZE: '1000'
      FIBR_THUMBNAIL_MIN_BITRATE: '30000000'
      FIBR_THUMBNAIL_URL: http://vith
      FIBR_TRACER_URL: http://jaeger.monitoring:14268/api/traces
      OTEL_SERVICE_NAME: fibr
    secrets:
      FIBR_AMQP_URI: AgCAfiYy6PM0B1K0AMiiDqzi4HPyNIMYBNwOPV7exSDRShiQfseyP6s5ZtOq9RDZS5nQxzfEpwctDIlpENDPG4g9Nnhnpvmv5ijZoKMFVMAuR+iJ7HH/bHUaixXNKqZ5RhWx5H900qK1SY169mNG+A4JLzpc7OCPcj3ZIbwZpR/94jwrGV50g9if+HFOFWV8aOjnxSMYbIKXp1KbjBLpdPQ79t8N1w5BBW9l1cJRDRf+P6k5xW3u9SG5XD6eEECDDjdqk3FnZnJ3+oCshOt3kuPlBu+zkfHFLMryFajc5VRyi4jWDzz/jfTLoxV/5urJ7oDAo+CPhDg2o0OsGI0TcWxsyWDazzPUmV+IlnqB+xcrnLd+rKyJeJ2v0QCyqtTGri1SEDaBXOVJ6jPyeLRyJglD0zqnd+o8pL14xTb2MLgHP9JriFqTgxQOZe+Bvyo/HZeSrU77JyCry9oX/uaJjwuHZwv/AhFeyStgM2QfA826scgzifEq2L5jDVq60AUqR2gPKHuR9EDgWCyka8XxMlRnY0WWNKud6ZDcYuPL9y6FMuWNJR1IqS4+j+1mkgRyb1LFpv2iX3sVUnp/DM+I5SwGVCu0lmyPbyxenBolkO+dIywHWMmrvM2qnTRncgE/HichJMzjvW5QEp5CYiWaMnkvkPZPA68sTgGDfYusLy+CtGtjdc7PNCJc9u7D1acrBcy0gxiopLbB4uj91gmYbmpFC6hjdim/G6+jgi84xFG6z309q0LGAbgrjKO27Dujk5ku1OY=
      FIBR_AUTH_USERS: AgCwD4sH3yRb0XPQcGVOdgzarEF07uQoKLCkjtC9LkZjh8Bj48kOHjopxalah4Q84Vtf1Mk0slSDzrXbbMLvohSrTVwuCEpHXFnD3QZa7J0Hh5Apj+5MxOjUbNmJlPefHYe66ocpJSrTgKOrs2g0Eub0I1uxg3zl61337TimDMrDHhWMBafgdDUuf+zxGiCFGjIGyT2ctVVvWldedDYWIecmyWauF/0dCFpsrKvWnemW/jkGOn3IjA4Y7PhEe4ZwFmiXkprrFnYnlQ+q7RbuUwyHY041KUYRubGGe8XziUZvGqWQQ/gnQ2sC2nbolIcqiqVffpS+QQXGt0U47Vetb1FBHhgJiZG77vcMxe5rQO/O5KM+dubfc5j7X3/c+gof/z7VUM/UwxtcQNjoJYVgtZyc49TmqDPZ1Rv3iM8XEeaV8nhbCRLDsGdq38QWDX5Yfu+iKIPKrV2L1kOAJxwuipDUT5ObEuFdAtkqpF2moWGBqlgZE4SKAwfbNT8MseP8SJBPi4kehKnsjDj66LSGXywBgBeN842KccMjrjexW1pJSZd1jNVOKYMYr5jFEsc8ty1wiyNsnA0K8wrEHRtfbVpy25gVMYGeOsr/Z9btsmzevFyfLLRJveORH+C1aT8cRVlOqKkCYHQh0cDpHrdpG88WLvSsgw9FcFHC3kyhOwfjYyOSF8YNMLELiu6y9qBk5evzQwalcTPAwRGQ+IZ0TydFfvZDupFe2P0dcIZsVFL9ItRCCgRncy8gHq24zIFb49UOnyqDWbzqNHJzP2z+OEb8/NXOmqY=
      FIBR_WEBHOOK_SECRET: AgBCKEwj7uXgGKzZeSSnr2aHOM+lRynm24Wq+NALFoSbO0B85wKp3KBTCoUZ/GakIsmBXbcwyJ82jNhi/L0WGKAWJOeqj9INfV/VtmfZU77bbNkPoMegJReaEqfkkNuHZ6C3nkKxfJbEU1wwf9KWtqjKbk6PZkuSXSySPuiq/bQxKS4d0rHkSK5SpsyMnySA3FbAsdUCTv5SwTpliSNbIAfJh3beeeu/pMT3XV4VQJFCbpbdxHGlQmp9BRqdJIHNB6AQZMQoktOHxu9s3/GW9EeVK1UbMvhSrjRwXxV6oxnoezuhi2/vtqj4v/lGMFHkrsKGWAPDsIWUQPjYo3Fqki+DvfIcE282dO2ELLWLbYUi6m8+lEpDQs3uJyAngy9hX5SFF2F/HPwAKtNep8g/cxdspbpQykdZq33zaYAtTMZMoJ++vB5s8DkKQ0CzXTG5GLoSJn29zsL40QDl9uFvWX6KcJp6NFQqE08JpLJRpLNypKeQY2Y0Q6iGz568P6Qd02XLcZzTgzIh+UERpR2oyKsK4AlaX/pSxT1pGCrsGYw/fFTccP61WUXRQjt4mtaBxzphXSCPxTADDOPl9CXD5lJ2fjqA5xKZQWl2DPS722AmE0Q5qSPU4YmWJm6+rf9x5YKNiZsobmNVxpsPpWH4Al27MBClFvGt+NqViu7F5SANNUhLxY9AYLY1TPjhd+8YDV7TZo4Qe1cv1DzoykUSBzGIFhH7C1EOrD5pI6n3RsvilVgJQi/UF80e5KcWyPrsUchoLWZDNk4VpiTJaMVRr3RHyJx+M9JQDGTtJN0W43eolACprBibgXv3FMKhSDLB
    tolerations:
      - effect: NoSchedule
        key: node-role.kubernetes.io/storage
        operator: Exists
    resources:
      limits:
        memory: 256Mi
      requests:
        cpu: 400m
        memory: 64Mi
    securityContext:
      runAsGroup: 1000
      runAsUser: 1000
      runAsNonRoot: true
      allowPrivilegeEscalation: false
    autoscaling:
      enabled: false
    ingress:
      enabled: true
      compress: true
      hosts:
        - fibr.vibioh.fr
    pprof:
      enabled: true
