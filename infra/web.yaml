apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: fibr
  namespace: default
spec:
  interval: 120m
  chart:
    spec:
      chart: app
      version: '0.0.86'
      sourceRef:
        kind: HelmRepository
        name: vibioh
      interval: 120m
  install:
    crds: Skip
  maxHistory: 3
  upgrade:
    remediation:
      retries: 3
  rollback:
    cleanupOnFail: true
  values:
    nameOverride: fibr
    image:
      name: vibioh/fibr
      tag: '202209031617' # {"$imagepolicy": "default:flux-fibr-web:tag"}
    volumes:
      - name: data
        persistentVolumeClaim:
          claimName: fibr
      - name: tmp
        emptyDir: {}
    volumeMounts:
      - name: data
        mountPath: /data
      - name: tmp
        mountPath: /tmp
    config:
      FIBR_CHUNK_UPLOAD: 'true'
      FIBR_EXIF_DIRECT_ACCESS: 'true'
      FIBR_EXIF_URL: http://exas
      FIBR_IGNORE_PATTERN: '.st(folder|ignore)'
      FIBR_LOGGER_JSON: 'true'
      FIBR_PUBLIC_URL: https://fibr.vibioh.fr
      FIBR_REDIS_ADDRESS: 'redis:80'
      FIBR_SANITIZE_ON_START: 'true'
      FIBR_THUMBNAIL_DIRECT_ACCESS: 'true'
      FIBR_THUMBNAIL_LARGE_SIZE: '1000'
      FIBR_THUMBNAIL_MIN_BITRATE: '30000000'
      FIBR_THUMBNAIL_URL: http://vith
      FIBR_TRACER_URL: http://jaeger.monitoring:14268/api/traces
      OTEL_SERVICE_NAME: fibr
    secrets:
      FIBR_AMQP_URI: AgCn+G//duuL91upLK4W7Vqby4UJiXLMH2gTbgzui1vayxC4ea1pTEJlH56IMb72eI4tdMTcrc5dDB9sbA6k9Zmp12KESxAcdaTwT+6Z2UPiDcXF6wTJObJtn3CRYlWGroCZV5+9BXXTGp1jHaeYoNsooGOTTUqj3ninO0nDB3Nei3OWVIU/LC6C6JvBNIwaPA+dPwih76lfgu1jDSls8InmI8Go223O2jmHfBLSxXLZlrlUPlM2MD+X3wOV2g8Y04ditLfNMCYFV6nA5zI35hwK5j60+NVR8K4uaUnNYGCetm2pfqQ6lXPJeLfguFM5oa9Wal83ZY4UxogDnw+/lkgwCLaR/ZzjCtORqa9Qpv1Duy5K3NSnEpmcmqZ6z+eKu2Y+AKqVS8GVSYlqEwGAYiNGBvG3esjrMh/WrK7MJKK0rWF7mmDtb/42oyBWYp4gme4dODye/sn+Bt7ZBTvi8v1YrqW93xWx9DM4u9L8klgkZCf1KNRRb2N5zfmKGHkkW05jCAGv8XqmPy25ra3Ti+VTqRSgdKgCOEF7g/syFPEWLrQIbNvpParEzKOqBOzRjzjQ6WXm+yPlPXRkxcZZNDCFl7NnLQ2+zAtFzu5oQMpivgIucT+qIDSxMDa2msJUmcXP4JWjFCeTa9JU4jAbuviH6skUYJPQsTE3H+bBGEEeZLl9m1jbOGtAUV6p3EY/PvRVtsQCXX536i9p2CigQ3nU6PqA1XFvOetFn8xrKOFZTE6agZ0pfwOrQHZo38nlevJrwDM=
      FIBR_AUTH_USERS: AgAsKCdUL2LhMJwpK2C9v6IYmYZvhabTQJs797WyCt9TwJR8B2qZzlnDjaLPZLd24vO/i2Y0ACCpN4CEOmWnI4wY03BZcA4RkwYWQMzAllFLiHsJZKlDiIiC/tGTWOZQK3vjxYBTeJv3cDk8l2Quc+rYo/j7frilYblpWe8h8saNUXmxC4wIWJ4PYjeHnMKufSZa29g0jCvSnGW0pHO08rjsAIu6p6eBbL+Qx+M1LUU7x+HZ8U5Irz9sFMJHEfaLM51JZwLyUk6Xwl57d0G/F9UP2BnPQ2QlhlBMeCItxfTW5NVe5teyZH5aF9J8gZTXV0FmjF49MYDhQZKpBv9W69TIxX1+75hfOHYn00w08+bnIRluH8MnbAFDQ9afSPybQP5FxwjOtD5u4mY2u6uVavuxpk5NO6bTi1QHXsLrFXMh2WJZAdRphSKURc5igevG0f03/2FZalaKzlgK6WrNwVnQnT/p8ln+tasbJKK3pfQmc6KG0VfHVdFSD1X8ojGPRgnPEz+VYZTayEEMF1d1selmSjOudcfpyxfuhh3qyuq3tUyxN3E1fqYj/U3cwCx5OuAI3SKOl3yoxPM3ATpzHj/z9pHM/2Z5Dg4ne5aZ5NpnOAzeabiDg/YOQtMm7fqYdQV3eGl5LS7ScLyQR40UU60AZ0ti7VoVd8ZGXE9rb0F0hVVJRcIT5Fe83bP393KdUkTCs9jtMmt5UiBU9rDE2Fmm1ZLLq/k7gx8doCAKoml7BgqQd+0GtW0Vc4oCPNdQrBfDhj3zjs5GF4fksIZTvqWz8vOS+w8=
      FIBR_REDIS_PASSWORD: AgCnyufAnddFZgVpshL9KFWbkXvtidyO2AlhFpcv3nPiGlqb+QqxC5M2ZaLEzt1vZuaLb3hkDSl1zBy7usmLhPCqsTGCH0JH2tGPkxo8OKa9eFTXzT0EKtoJI7HKHK7D1b5z9IhSEa+sPXvYWVtLjCSvfAXw8/pI+MoDlu1TGmHZvqDpthK1OTu048gVY9NBylpudZ2kQA33Ccfx8tQ0w7RJEswOMScMJ+w7iVuDZrc84NZ0NwdI+lxiTBIP3g2iCh1ENf/2pcB6DqWg5oeFqoYZvK9UXA4qVs/1/EYss7FoODwTnDletITjrfQkx2N9/Z4xUFnW3tY8EITYX5t8uflYg690vfYFBmIoPBpGMHdEr/aicj0YqqtH/7YG4q7ubJqmiGNAjVtUhe9p1jRNppRQQbuLvwKCwxOGMGl9ecUKci9MdR+qM049SSVZJHY1QdZreOoVb4hnrbxQq0s8qyF47IpkwaBh+KEJSepQ7AG2h0wzGc2ln5k7CE5fob0txUzk+Y2nns81maH1nWixCioRDwVMfBjcDWPB3Q5hDt6kHqIpunSEqoe0GVP6SH8ncmcbkJTPwqL44XwTiKcVrTBNuxDbbflTZ0FgXmJP41L6WiScwxN3i6SFTHa3T3rWrktqOHULXabb2UTsW+VvtdX+wx7o35mqaLdI2dkFuB8ZdtWDejX+AZ62hmoK+8tZNsIYWXplaIKYDMojeGJl/JmKsXPbc5QPYYW+8txFImmtyAvXTzY8rF5DSiosZoGeQ97bVZdAHv1rQlrBHAWz+Pg=
      FIBR_WEBHOOK_SECRET: AgABOeEa3Obbd73SJR32wQ3g5xIlBPCT1jQ3DKYOjzjr6tjz/TmOaVepNtBcX8EU++SQw5tGM6KRJPRyf3bUYKCGnmEsbujJ4OY1MdhaY2iB2FslxMQnx97hvbvYglPltp3hsBuO35r1tzCxXJgWKdWpOSEYQRrGcwzDOGQY71rJX2bMv+lQ4Jr4zXQfsfCW2tCFcpyp5nm6gXmmR0ewlQosdhVEJNXCq1njB42bTVvwLwFKsFIBzLONQYNWLqEa5FVz7EiUkU8ro3ax5So62a8R08bmDAdIzm1TZjdjGywQ23NbGgX6cP8GwAqaenOZ0SE74UXui/ff5HGVef3mGTNYpWlEONfB6qsjemOzR9SihXMysGJMrQ3AnL3VUZJnBUKttxd/iz7hTVHqPcv8rrKESOrODtl94QCIy+7K/u3kZgwlIYj6nn29jo8I/Wpr0Q/1HfUHLIjkPendwr9CTKrmrwKRAl1SkBsoIKGh7WZ8/UFXyQp+fuKdVEzIQ/K4ed/zpJ73MVzX8ATrHa3teBhg69bG/sPgyK7LhE8VbQ57f1gUaZ6VPsBQGRkG/7qsfDSD8MjQhJrAzoIS/THqwN9zWsyzc+Gv/uWMr++kwm2CLeD7yw1SZCpvBB4ebM6GEXH7qtuJQ7W07t/1Rwezhv1JqLKPdl0MAXKJ7VTdZANnvz5ge9KinlMsSli4a8dr1KOtsTW52+C2CiTDkQ2G/RmaQi4VBSpxrioKvVwRkRaWTxy/RO7PPazOy1LvjdjycW4MasPP2PmCyouODR0nUctyADdELxTmUgHIvdUUQ+tDsKkZKo0akn/gTrSBSCFV
    tolerations:
      - effect: NoSchedule
        key: node-role.kubernetes.io/storage
        operator: Exists
    resources:
      limits:
        memory: 96Mi
      requests:
        memory: 96Mi
    securityContext:
      runAsGroup: 1000
      runAsUser: 1000
      runAsNonRoot: true
      allowPrivilegeEscalation: false
    autoscaling:
      enabled: false
    ingress:
      enabled: true
      sticky: true
      hosts:
        - fibr.vibioh.fr
    pprof:
      enabled: true
