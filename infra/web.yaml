apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: fibr
  namespace: default
spec:
  interval: 120m
  chart:
    spec:
      chart: app
      version: '0.0.75'
      sourceRef:
        kind: HelmRepository
        name: vibioh
      interval: 120m
  install:
    crds: Skip
  maxHistory: 3
  upgrade:
    remediation:
      retries: 3
  rollback:
    cleanupOnFail: true
  values:
    nameOverride: fibr
    image:
      name: vibioh/fibr
      tag: '202108281612' # {"$imagepolicy": "default:flux-fibr-web:tag"}
    volumes:
      - name: data
        persistentVolumeClaim:
          claimName: fibr
    volumeMounts:
      - name: data
        mountPath: /data
    config:
      FIBR_AUTH_PROFILES: 1:admin
      FIBR_IGNORE_PATTERN: '.st(folder|ignore)'
      FIBR_LOGGER_JSON: 'true'
      FIBR_SANITIZE_ON_START: 'true'
      FIBR_EXIF_DATE_ON_START: 'true'
      FIBR_EXIF_AGGREGATE_ON_START: 'true'
      FIBR_THUMBNAIL_VIDEO_URL: https://vith.vibioh.fr
      FIBR_THUMBNAIL_IMAGE_URL: https://imaginary.vibioh.fr
      FIBR_EXIF_URL: http://exas
      FIBR_EXIF_GEOCODE_URL: 'https://nominatim.openstreetmap.org'
    secrets:
      FIBR_AUTH_USERS: AgAC3NPujqeHIkNIJQ5TLB+OquA+XDy7khc5HOVU/Op4oTRSYlmvmYSk8kyPqU+DLT1MSpOpZrFRYM6da080kvnAVXYHer7o2OikJlXxjyOyRpTDA4cj6Aaew04Vl63mepUn5U+0yhz5LNQSkjl5XbY03xs5Ee+oOp/IgZez0i1d7Q2Gt3aEusunscXdu4ArgvO311kZMZ8JuZhf1rNtf51r0Cw0YCDP21I2HbMFxtGLJ2Z+FVDHAUQu10jkP5OAipIL5E71mqoogGiIdB04X7mot9Yunu0tfwA6FLK50JCkJenraO3c0NG6Io9KoURVMjzPVxL0nqZHmPFgVE3xJIW1WzSnh2BwIHZKj/YwmuEOtFO2i15lksXckGaVdB/2YNuwpQAaQNbDCeE5cH5sQCkK2lu6ia6+wnW/OrgxhvyhMoNyvCqAJC/GYhKGGUcJnrQnLxSmGKt+FJ2tsUVNeMs8itWgdCao7kMiafWHFo5XOSakkTyHD9CJV+OGGCxZRweWWVMP+Qi2nxQBkQNsr4kbqbeFzR1E4fn7Q1I9AGcKvLsuYxyRK2ty691keO57JNS2q5VZLAfjwLwueEJJXCi0cjXU5P7DS9IYqik1qzF5VQhsNUTK1n2m9bzRTXgAX5oq/1H4NUbv6l71uRWFvSbgCNIECZ0GeZ9cKW5hKku/y8nIVGFYBh1Er6Cm/SgChOtFPrugKj7Vbgecn8+e9Up3izO6wUzgw7tO8w/313KxHgNeQlxLXqpnLsdw//lNzfSf1fO6W2o3NIPUXce8EdShBHD8tIw=
      FIBR_WEBHOOK_SECRET: AgB4+6bsbyqLuKun43wvMs1ppJv6YTzxGvTbFGmnBkVAwnnO27jcc/lvFBS6EnABgEOt4x4bYkrAAz0r6At8KI+MVYfy11XVjqjnZkWRlxuUyf2LnJVxZuAa/wZQP/EBQJvPMdaPWG1VGZB7H7xsNWaIhiaEfIdNWyxRgMxIZsE8OWGRt6z854BEPI4jWJ2vaVSaiclJlg5cPyh+HPyOuec16Y3orpDs84SFYIeQ80MXTvNrEnwXI0ufzRftIvYV8OdMjVzZ3beCbqznvWsW4lMg2/klRryE/Fb99RktMVlLn2si6SmohUuf/JA6SdvTYu1S/OjUIgFFUHLz+AdkMy7oxVdubnFaqlRO7a39GMhnyOJAF0fKT6F+F8Ws/+FyF0zSmZnQJtGf3v8n/kq40rKNAglk7zA+/yTEYujVD5kwfIZ85UjZlnvIIT7O9Y3WmOcU+pVgii+wSQX6nYDZ8hurP58tKdkdDud/bHaXCiGlyxEs264nS5VBbjBAMritclAahKnvUnSNraHmBx41UFTQuXJFLtFf0OO3p5H5Xm4kmWs4IzsgkKOX0yS8eRxSAuaDN3PHUYexlBNcV3Q+Quah3qKsjPFnhDYA63uiZDW6kFNpNeXWnTBiDQF9/fPGEr7+W6ueA0g21mAv2fS/LgJZNfhddOurv2WhaN+387r4cMImVvp28btBSqnDsbkwZ7JzSH6tVcAqeSpIj8zfvQJHWFKnRjL4Vxe0AQ16GE4mQ9jkaBB3u2uUE1LgPn2vhpkhRVFs6RslG4QZ/1K8GsTg739IJjydbO28Fjs1G2pJBbAxLMkHlL5JdqlExRKI
      FIBR_THUMBNAIL_VIDEO_USER: AgCRyfl4ALbKkcht0X0v4dhHQwvwNzDOiooDgmD+6ILJ+9q8btsv9JR8tt0f1CS/w88mF5mnJT6aW7ZmO6Pk4vFPnY/hZuHqKjLRRBhZi87Tb8+JRuWbTX2ddzH4iF2siYgVsnPUnjBT3eRrDgsJLQB9p1UTbdlBp8uYrhRAsf6Te7m1vzXjlyL4vuY0dj7xwJI5YGhZSJ3DWbR6p2kgueYQ1nEM44kd0F/EYx/SRJfTXRjJCePvEbcbMmQpvt1V4ox9iPbeQ24R84Wb1GFiVNB92S26MBXUI9fnqYwSebJ5TqCcGb2N6zfCpMT1ISt301lRcqqQkCnG13lZ9Ak/R0uyrFMxxFpzJwXIapy50w4ocrVdr4DY/uEZnPM87XQVMjd3MH1D3l70ylvv/s9Yl+L242qcIuczOsUpWrz8DpzYj+1JH3d3q5GDWBo3+nMmdLEaY8FydDYwpc7soc42cgSPTBJ6j2jLYumN9Sx9SdNk39UtQXHEB+XWo/3ZyLz1GkjIwhjWM5EsPC/pD68By0iZRlJ7qEiT0JyegrSRW4p2wEf3hKsA+nFOZRifbOmWUigbpyx/znURK64b8cpMLTDksyoWvYcvPNcshm2kq/drIU0d26eAZS5uHnP+bBafkehrPp5lTi5tN5iJM3hDg6f8WDhRbKNByaLtjc77d2BB+XpkGhZXSy6AVjbIvNTQTWp0Oa5VIOk=
      FIBR_THUMBNAIL_VIDEO_PASSWORD: AgCiQhqvLZcu3N9XMm0sT2VUZ7sGk1pp5WsWz4BN+XN7cfMFdFM050TDDq3e1R0uwsrO+cBNlDkZiu8zTMg+aS3gcQFRKMOm8CewTYJAzsP1Zvyc+U2GmyXZOt5d0IoWKo9mg+TgFjCSMkyzzhXsln92nQ0w69qoZG/flKlUil4HkX30oeqBwZF3ZmwtsrzPERrhThCq2R5Fh4RmUz7xkufx085ognGqtZC0fL6XObyVxSGvNqu/WqWJzVKNxkr5eblvrPv8dzIPvc7vOrFMupVvsk2cH+RFQdzPnc8hGIKLyh5cKYHRPzBrFVB3T2SjOL8Xl++TLFAAR/Bb7lERiaj2Kx/IC0Aoc+M1lBE70BjQCd/EjTDzNKAcUTH3T5yvKm0MXKQFEYZg9Ofr7EmMsyPFrAYimqIclm7cOg6LIfdgObqQSwKGr0mnIjTn1qphRaHZdwKacFGTCxyroXLRuTNOukG7ZBtGMooM+DjAV51++hkST2X4flacgmrnhWbrHT5bUliJQMIOKlsY1hhw+MOJUmrj7rDHCUt3ZSTd+Nn22v4HTgwTdTbSfZBdE7lGdqM1a8a7BL0zKLyEQoJsiHr0/7AB/WgXmtbtdR76zYNX/Gi3Ju7n+rkOcSGxan2DIDbMgnQJDIc6ksAgNy9pk3rTI2579A2yBWhid8QSyM/cqxvgPPAuXEawMhjhObgSPTHybRYVGTdc7CVETGGZvdjmFNtP66V4UWck5kjpPOaD6sB4tNLIAxIIUq2HMVCwum8Jh2eTHKAp+do7j9w=
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
            - matchExpressions:
                - key: kubernetes.io/hostname
                  operator: In
                  values:
                    - bob
    resources:
      limits:
        memory: 256Mi
      requests:
        cpu: 400m
        memory: 64Mi
    securityContext:
      runAsGroup: 995
      runAsUser: 999
      runAsNonRoot: true
      allowPrivilegeEscalation: false
    autoscaling:
      enabled: false
    ingress:
      enabled: true
      compress: true
      hosts:
        - fibr.vibioh.fr
