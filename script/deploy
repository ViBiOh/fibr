#!/usr/bin/env bash

set -o nounset -o pipefail -o errexit

main() {
  local HTTP_OUTPUT="http_output.txt"
  local HTTP_STATUS
  HTTP_STATUS=$(curl -sSqL --max-time 90 -X POST -u "${DEPLOY_CREDENTIALS}" -o "${HTTP_OUTPUT}" -w "%{http_code}" "https://deploy.vibioh.fr/${1}/" --data-binary "${2}")

  cat "${HTTP_OUTPUT}" && rm "${HTTP_OUTPUT}"

  if [[ "${HTTP_STATUS}" != "200" ]]; then
     exit 1
  fi
}

main "${@:-}"
