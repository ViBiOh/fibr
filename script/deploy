#!/usr/bin/env bash

set -o nounset -o pipefail -o errexit

main() {
  local OUTPUT_TXT="output.txt"
  local HTTP_STATUS
  HTTP_STATUS=$(curl -q -sS -X POST -u "${DEPLOY_CREDENTIALS}" -o "${OUTPUT_TXT}" -w "%{http_code}" "https://deploy.vibioh.fr/${1}/" --data-binary "${2}")

  cat "${OUTPUT_TXT}" && rm "${OUTPUT_TXT}"

  if [[ "${HTTP_STATUS}" != "200" ]]; then
     exit 1
  fi
}

main "${@:-}"
